<!DOCTYPE HTML>
<html lang="zh">
<head>
	<meta charset="UTF-8">
	<title>Hello World</title>
	
	<link rel="stylesheet" href="css/bootstrap.min.css" />
	<link rel="stylesheet" href="css/page.css" />
	<script src="js/jQuery.js"></script>
	<script src="js/tipdata.js"></script>
	<script src="js/common.js"></script>

</head>
<body>
	<div class="msg-box">
		<div class="msg hide" id="msg" >loading...</div>
	</div>
	<div class="container">
		<div class="">
			<ul class="tabs">
				<li id="showAddPage" class="active" ><a href="#">Add</a></li>
				<li id="showViewPage"><a href="#">View</a></li>
				<li id="goSettingPage"><a href="#">Settings</a></li>
				<li id="goHelpPage" ><a href="#">help?</a></li>
			  </ul>
		</div>
		<div class="row">
			<div class="span8">
				<div id="addPage" >
					<form id="addAndSaveForm">
						<fieldset>
							<legend>Add Word</legend>
							<div class="clearfix">
								<label for="keyword" class="span2" >Word</label>
								<div class="input">
								  <input class="span5" id="keyword" name="word" size="30" type="text" placeholder="add new word">
								</div>
							</div>
							<div class="clearfix">
							<label for="description" class="span2"  >Description</label>
							<div class="input">
							  <textarea class="span5" id="description" name="des" rows="3" placeholder="description the word" ></textarea>
							</div>
						  </div>
						  <div class="actions">
							<input type="submit" class="btn primary" value="Add and Save" id="addAndSave" >
						  </div>
					  </fieldset>
					</form>
				</div>
				
				<div id="viewPage" class="view-word hide" style="min-height:231px;max-height:500px;overflow-y:auto;"  >
					<ul class="breadcrumb">
						<li><a href="#" id="yesterday" >昨天</a> <span class="divider">/</span></li>
						<li class="active" id="today" >今天</li>
						<li> <span class="divider">/</span><a href="#" id="tomorrow" >明天</a></li>
					</ul>
					<div id="viewList">  </div>
				</div>
			</div>

		</div>
		<video id="playVodeo" controls="" autoplay="" style="display:none;" name="media" src="#"></video>
	</div>
	
	
	<script>
		$('#viewList .read').live('click', function(){
			var word = $(this).attr("data-word");
			$('#playVodeo').attr("src", "http://translate.google.com/translate_tts?ie=UTF-8&q="+ word +"&tl=en&prev=input");
		});
		
		Common.page = {
			pageIds:"#addPage,#viewPage",
			menuIds:"#showAddPage,#showViewPage",
			addPage:function(){
				$(this.pageIds).addClass("hide");
				$("#addPage").removeClass("hide");
				$(Common.page.menuIds).removeClass("active");
				$("#showAddPage").addClass("active");
			},
			viewPage:function(dayTime){

				$(this.pageIds).addClass("hide");
				$("#viewPage").removeClass("hide");
				$(Common.page.menuIds).removeClass("active");
				$("#showViewPage").addClass("active");
				
				var bg = Common.getBackground();
				var time = dayTime || Common.getDayTime();
				var dayData = bg.UserData[time];
				var html = "";
				
				$('#yesterday').text(Common.sortFormat(time*1000 - 86400000));
				$('#tomorrow').text(Common.sortFormat(time*1000 + 86400000));
				$('#today').text(Common.sortFormat(time*1000));
				
				$('#yesterday').unbind('click').bind('click', function(){
					Common.page.viewPage((time * 1000 - 86400000) / 1000);
				});
				$('#tomorrow').unbind('click').bind('click', function(){
					Common.page.viewPage((time * 1000 + 86400000) / 1000);
				});
				
				if(dayData){
					for(var i=dayData.length-1; i>=0; i--){
						html += Common.tmpl(Common.item, dayData[i]);
					}
				}else{//当天数据不存在 就请求数据
					Common.getDayData(time, function(data){
						Common.page.viewPage(time);
					});
				}
				$('#viewList').html(html);
			},
			regEvent:function(){
				$(this.menuIds).each(function(i){
					var i = i;
					$(this).click(function(){
						var time = Common.getDayTime();
						if(i == 0){
							Common.page.addPage();
						}else if(i == 1){
							Common.page.viewPage( Common.getDayTime() );
						}
					});
				});
				$('#goSettingPage').click(function(){
					chrome.tabs.create({url:'temp/options_page.html'});
				});
				$('#goHelpPage').click(function(){
					chrome.tabs.create({url:'temp/help.html'});
				});
			},
			addReg:function(){
				$('#addAndSaveForm').submit(function(){
					var word = $('#keyword').val();
					var des = $('#description').val();
					var url = config.host+"server/add.php";
					if(word){
						Common.post(url, {word:word, des:des}, function(data){
							if(data.code == 200){
								var bg = Common.getBackground();
								var userData = bg.UserData;
								var dayTime = Common.getDayTime();
								if(userData && userData[dayTime]){
									console.log(data.result);
									Common.addData([data.result], dayTime);
									
								}
								Common.page.viewPage(dayTime);
							}
						});
					}
					return false;
				});
			}
		};
		Common.page.regEvent();
		Common.page.addReg();
	</script>
</body>
</html>