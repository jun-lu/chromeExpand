<!doctype html>
<html lang="zh-cn">
<head>
        <meta charset="UTF-8">
        <title>Login</title>
		<link rel="stylesheet" href="../css/bootstrap.min.css" />
		<link rel="stylesheet" href="../css/page.css" />
		<script src="../js/jQuery.js"></script>
		<script src="../js/tipdata.js"></script>
		<script src="../js/common.js"></script>
		
		
    </head>
    <body id="options" >
		<div class="msg-box">
			<div class="msg hide" id="msg" >loading...</div>
		</div>
        <div id="wrapper">
            <header>
                <h1>Login</h1> <a href="help.html">help?</a>
            </header>
            <section>
            	<div id="loadingWrap" >
					<form id="loadingform">
						<fieldset>
							
						   <div class="clearfix">
								<label for="email" class="span2">Email</label>
								<div class="input">
								  <input class="span3" id="email" name="email" size="30" type="text" tabindex="1" placeholder="input the email or username"  > <a href="signup.html">Sign Up</a>
								</div>
							</div>
							<div class="clearfix">
								<label for="PWD" class="span2">PWD</label>
								<div class="input">
								  <input class="span3" id="PWD" name="PWD" size="30" type="password" tabindex="2"  >
								</div>
							</div>
							<div class="actions">
									<input type="submit" class="btn primary" value="Login" id="loginBtn" tabindex="3"  ><br/><br/>
									<ol>
										<li>您可以先<a href="signup.html">注册</a>一个账户，然后在进行登录！</li>
										<li>如果登录失效必须重新登录。</li>
									</ol>
							</div>
							
						</fieldset>
					</form>
				</div>
				
				<div id="loading" class="hide">
					<form id="loadingform2">
						<fieldset>
							
						   <div class="clearfix">
								<label for="email2" class="span2">Email</label>
								<div class="input">
								  <input class="span3" id="email2" disabled name="email2" size="30" type="text" tabindex="1"   >
								</div>
							</div>
							<div class="clearfix">
								<label for="PWD" class="span2">PWD</label>
								<div class="input">
								  <input class="span3" id="PWD2" disabled name="PWD2" size="30" type="text" value="***" tabindex="2"  >
								
								</div>
							</div>
							<div class="actions">
									<input type="submit" class="btn primary" value="Login out" id="loginOutBtn" tabindex="3"  >  <input type="button" class="btn error" value="Close Tab" id="CloseTab" tabindex="3"  ><br/> <br/>
									<ol>
										<li>关闭此页面，在浏览器右上角使用应用</li>
										<li>如果登录失效您必须重新登录一次</li>
									</ol>
							</div>
						</fieldset>
					</form>
				</div>
				
            </section>
        </div>
		
		<script>
			
			Common.page = {
				isLogin:function(){
					//return Common.cookie.get("mail") && ;
					return Common.getItem("mail") && Common.getItem("pwd");
				},
				login:function(){
					$('#loadingWrap').removeClass("hide");
					$('#loading').addClass("hide");
					$('#email').val(Common.getItem("mail"));
				},
				loginOut:function(email){
					$('#loadingWrap').addClass("hide");
					$('#loading').removeClass("hide");
					$('#email2').val(email);
				},
				loginOut:function(email){
					$('#loadingWrap').addClass("hide");
					$('#loading').removeClass("hide");
					$('#email2').val(email);
				}
			};
			$('#loadingform').submit(function(){
				var email = $('#email').val();
				var PWD = $('#PWD').val();
				var url = config.host+"server/login.php";
				$('#loginBtn').attr("disabled", true);
				Common.post(url, {email:email, pwd:PWD}, function(data){
					$('#loginBtn').attr("disabled", false);
					if(data.code == 200){
						Common.showTip({code:201}, 0);
						Common.page.loginOut(email);
						Common.getBackground().UserData = [];
						Common.setItem("mail", email);
						Common.setItem("pwd", PWD);
					}else{
						$('#PWD').val("").focus();
					}
				});
				return false;
			});
			
			$('#loadingform2').submit(function(){
				var url = config.host+"server/login_out.php";
				Common.post(url, null, function(data){
					Common.showTip({code:420});
				});
				Common.page.login();
				Common.removeItem("pwd");
				Common.getBackground().UserData = [];
				return false;
			});
			
			$('#CloseTab').click(function(){
				window.close();
			});
			//var mail = Common.page.isLogin();
			if( Common.page.isLogin() ){
				var mail = Common.getItem("mail");
				Common.page.loginOut(decodeURIComponent(mail));	
			}else{
				$('#email').val(Common.getItem("mail"));
			};
		</script>
</body>
</html>